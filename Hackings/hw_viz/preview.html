<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Interactive Numbers Every Programmer Should Know</title>
    <script src="http://codemirror.net/lib/codemirror.js"></script>
    <script src=http://codemirror.net/mode/xml/xml.js></script>
    <script src=http://codemirror.net/mode/javascript/javascript.js></script>
    <script src=http://codemirror.net/mode/css/css.js></script>
    <script src=http://codemirror.net/mode/htmlmixed/htmlmixed.js></script>
    <link rel=stylesheet href=http://codemirror.net/lib/codemirror.css>
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
        padding-left: 10px;
        padding-right: 10px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
    </style>
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <style type=text/css>
      .CodeMirror {
        width: 99%;
        border: 1px solid black;
      }
      iframe {
        width: 99%;
        height: 400px;
      }
    </style>
  </head>
  <body>
    <iframe id=preview></iframe>
    <textarea id=code name=code>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script>
    function getPayloadBytes() {
        // 1 MB
        return Math.pow(10, 6);
    }
    function getCycle() {
        return 0.5; // ns
    }
    function getL2Latency() {
        return 7; // ns
    }
    function getMemLatency() {
        return 100; // ns
    }
    function getNICTransmissionDelay(payloadBytes) {
        // 1Gb/s = 10^9 b/s = 1b/ns
        // Bytes -> bits
        return payloadBytes * 8;
    }
    function getBusTransmissionDelay(payloadBytes) {
        // 1MB / 250,000 ns = 10^6B / 250,000 ns = 4B/ns
        return payloadBytes / 4;
    }
    function getSSDLatency() {
        return 150000; // ns
    }
    function getSSDTransmissionDelay(payloadBytes) {
        // 1MB / 1,000,000 ns = 1B/ns
        return payloadBytes;
    }
    function getSeek() {
        // Not changing by much
        return 10000000; // ns
    }
    function getDiskTransmissionDelay(payloadBytes) {
        // 1MB / 20,000,000ns = 1/20 B / ns
        return payloadBytes / (1.0/20); // ns
    }
    function getDCRTT() {
        // Not changing by much
        return 500000; // ns
    }
    function getWanRTT() {
        // Not changing by much
        return 150000000; // ns
    }

    // Display functions:
    function drawBoxes(n, div, color) {
        var cw = 100;
        var ch = 100;
        var rects = d3.select("#" + div).
         append("svg:svg").
         attr("width", cw).
         attr("height", ch);

        var length = 10;
        var whitespace = 2;

        for (var y = 0; y < ch; y+=length) {
            for (var x = 0; x < cw; x+=length) {
                rects.append("svg:rect").
                  attr("x", x).
                  attr("y", y).
                  attr("height", length).
                  attr("width", length).
                  attr("style", color);

                n -= 1;
                if (n <= 0) {
                   return;
                }
            }
        }
    }

    function Metric(ns, boxType, displayString, div) {
        this.ns = ns;
        if (boxType == "ns") {
          this.color = "stroke:#FFFFFF; fill: #000000"; // black
          this.boxes = ns;
          this.alternateUnit = "";
        }
        else if (boxType == "100ns") {
          this.color = "stroke:#FFFFFF; fill: #0000FF"; // blue
          this.boxes = ns / 100;
          this.alternateUnit = " = " + (ns / 1000) + "&mu;s";
        }
        else if (boxType == "10us") {
          this.color = "stroke:#FFFFFF; fill: #00CC00"; // green
          this.boxes = ns / 10000;
          this.alternateUnit = " = " + (ns / 1000) + "&mu;s";
        }
        else if (boxType == "ms") {
          this.color = "stroke:#FFFFFF; fill: #FF0000"; // red
          this.boxes = ns / 1000000;
          this.alternateUnit = " = " + (ns / 1000000) + "ms";
        }
        this.displayString = displayString + this.ns + "ns" + this.alternateUnit;
        this.div = div;
        this.fillDiv = function() {
          drawBoxes(this.boxes, this.div, this.color);
          document.getElementById(this.div + "t").innerHTML = this.displayString;
        }
     }

    var ns = new Metric(1, "ns", "", "ns");
    var L1 = new Metric(getCycle(), "ns", "L1 cache reference:", "L1");
    var branch = new Metric(10*getCycle(), "ns", "Branch mispredict:", "branch");
    var L2 = new Metric(getL2Latency(), "ns", "L2 cache reference:", "L2");
    var mutex = new Metric(50*getCycle(), "ns", "Mutex lock/unlock: ", "mutex");
    var ns100 = new Metric(100, "100ns", "", "ns100");
    var mem = new Metric(getMemLatency(), "100ns", "Main memory reference:", "mem");
    var zippy = new Metric(6000 * getCycle(), "100ns", "Compress 1KB wth Zippy: ",
                           "zippy");
    var tenMicro = new Metric(100*100, "100ns", "", "tenMicro");
    var network = new Metric(getNICTransmissionDelay(2000), "10us",
                              "Send 2KB over 1Gbps network:", "network");
    var ssdRandom = new Metric(getSSDLatency(), "10us", "SSD random read: ", "ssdRandom");
    var mbMem = new Metric(getBusTransmissionDelay(getPayloadBytes()), "10us",
                            "Read 1MB sequentially from memory:", "mbMem");
    var rtt = new Metric(getDCRTT(), "10us", "Round trip in same datacenter: ", "rtt");
    var ms = new Metric(100*100*100, "10us", "", "ms");
    var mbSSD = new Metric(getSSDTransmissionDelay(getPayloadBytes()), "ms",
                           "Read 1 MB sequentially from SSD:", "mbSSD");
    var seek = new Metric(getSeek(), "ms", "Disk seek", "seek");
    var mbDisk = new Metric(getDiskTransmissionDelay(getPayloadBytes()), "ms",
                            "Read 1MB sequentially from disk:", "mbDisk");
    var wan = new Metric(getWanRTT(), "ms", "Packet roundtrip CA to Netherlands:", "wan");
    var metrics = new Array(ns,L1,branch,L2,mutex,ns100,mem,zippy,tenMicro,network,
                            ssdRandom,mbMem,rtt,ms,mbSSD,seek,mbDisk,wan);
    </script>

    <!-- Le styles -->
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
    </style>
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container-fluid">
      <h4> Latency Numbers Every Programmer Should Know</h4>
      <div class="row-fluid">
        <div class="span3">
          <div class="row-fluid">
              <div class="span2" id="ns"></div>
              <div class="span1" id="nst"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="L1"></div>
              <div class="span1" id="L1t"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="branch"></div>
              <div class="span1" id="brancht"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="L2"></div>
              <div class="span1" id="L2t"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="mutex"></div>
              <div class="span1" id="mutext"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="ns100"></div>
              <div class="span1" id="ns100t"></div>
          </div>
        </div><!--First Column-->
        <div class="span3">
          <div class="row-fluid">
              <div class="span2" id="mem"></div>
              <div class="span1" id="memt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="micro"></div>
              <div class="span1" id="microt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="zippy"></div>
              <div class="span1" id="zippyt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="tenMicro"></div>
              <div class="span1" id="tenMicrot"></div>
          </div>
        </div><!--Second Column-->
        <div class="span3">
          <div class="row-fluid">
              <div class="span2" id="network"></div>
              <div class="span1" id="networkt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="ssdRandom"></div>
              <div class="span1" id="ssdRandomt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="mbMem"></div>
              <div class="span1" id="mbMemt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="rtt"></div>
              <div class="span1" id="rttt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="ms"></div>
              <div class="span1" id="mst"></div>
          </div>
        </div><!--Third Column-->
        <div class="span3">
          <div class="row-fluid">
              <div class="span2" id="mbSSD"></div>
              <div class="span1" id="mbSSDt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="seek"></div>
              <div class="span1" id="seekt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="mbDisk"></div>
              <div class="span1" id="mbDiskt"></div>
          </div>
          <div class="row-fluid">
              <div class="span2" id="wan"></div>
              <div class="span1" id="want"></div>
          </div>
        </div><!--Fourth Column-->
      </div><!-- row-fluid -->
    </div><!--/.fluid-container-->

    <!-- Fill in the columns -->
    <script>
        for (var i in metrics) {
          var metric = metrics[i];
          metric.fillDiv();
        }
    </script>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://twitter.github.com/bootstrap/assets/js/jquery.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-transition.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-alert.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-modal.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-dropdown.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-scrollspy.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-tab.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-tooltip.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-popover.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-button.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-carousel.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-typeahead.js"></script>
  </body>
</html>
</textarea>
    <script>
      var delay;
      // Initialize CodeMirror editor with a nice html5 canvas demo.
      var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        mode: 'text/html',
        tabMode: 'indent'
      });
      editor.on("change", function() {
        clearTimeout(delay);
        delay = setTimeout(updatePreview, 300);
      });
      function updatePreview() {
        var previewFrame = document.getElementById('preview');
        var preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
        preview.open();
        var contents = editor.getValue();
        preview.write(contents);
        preview.close();
      }
      setTimeout(updatePreview, 300);
    </script>
  </body>
</html>
